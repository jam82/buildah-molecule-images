# file: .travis.yml
dist: bionic

language: minimal

before_install:
  - sudo add-apt-repository -y ppa:projectatomic/ppa
  - sudo apt-get update -qq
  - sudo apt-get install -qq -y software-properties-common podman buildah libsecret-tools
  - sudo mkdir -p /etc/containers
  - sudo sh -c 'echo "[registries.search]\nregistries = [\"docker.io\"]" > /etc/containers/registries.conf'
  - cat /etc/containers/registries.conf
  - podman info

env:
  - build_distribution=alpine PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=amazonlinux PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=archlinux PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=centos PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=debian PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=fedora PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=opensuse PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=oraclelinux PATH="$PATH:/usr/lib/cri-o-runc/sbin/"
  - build_distribution=ubuntu PATH="$PATH:/usr/lib/cri-o-runc/sbin/"

script:
  - make $build_distribution
  - make push
